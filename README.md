# ナイトガーデン用ディスコードBOT
このソフトウェアは、ゲーム「プリンセスコネクト!Re:Dive」のクラン「ナイトガーデン」専用Discordサーバーで運用するBotの為に作られました。
このドキュメントでは、各スクリプトの動作説明をします。

## Ngbについて
ナイトガーデンでは現在、王宮、宮殿、城下町の3つのクランに分かれており、それぞれ専用のチャットルームが用意されています。
そのチャットルームへアクセスするための権限を、ユーザーがいつでも自由に取得できるように作られました。
Ngbを動作させるためには役職を編集できる権限が必要です。
### コマンド一覧
- `/bot`
このコマンドを実行したユーザーに 1:王宮 or 2:宮殿 or 3:城下町 のいずれかの役職を付与します。
botからレスポンスがあるので、その後 1 2 3 いずれかの半角数字をチャットしてください。
- `/role (member ,role)`
引数で指定したメンバーに引数で指定したロールを付与します。

## Reserveについて
簡易的な凸予約ツールです。ソースのBOSSES変数にボスの名称を入れて使ってください。
### コマンド一覧
- `/yoyaku`
予約、凸予約、予定でも可。現在の予約状況を返します。
- `/(ボス名)`
このコマンドを実行したユーザーを、ボス名の予約キューに追加します。
- `/kantotu`
凸完了、完了、クリアでも可。このコマンドを実行したユーザーの予約をすべて削除します。

## TotuCountについて
あらかじめ設定した作業チャンネル上にクラバトログのスクショを張り付けると、Botが[tesseractOCR](https://github.com/tesseract-ocr)を使用して解析し、凸カウントします。
**※クラバトログのスクショは被り、漏れを考慮していません。**
### コマンド一覧
- `/define`
このコマンドを実行したチャンネルを作業チャンネルとします。
- `/remove`
作業チャンネルでこのコマンドを実行すると作業チャンネルから除外されます。
- `/totu`
残凸数をメッセージで返します。
- `/clear`
残凸数をクリアします。日付が変わったときに使用してください。


## SaveResultについて(現在無効)
作業チャンネル上にクラバトログのスクショを張り付けると、Botが[tesseractOCR](https://github.com/tesseract-ocr)を使用して解析し、Excelに自動で書き込む他、凸数をカウントしたりします。ソースのBOSSES変数にボスの名称を入れて使ってください。
**※注意**
- あらかじめ設定した作業チャンネル以外では動作しません。
- クラバトログのスクショは、被り、漏れを考慮していません。
- 読み取り精度の問題で、現状6割ぐらいしか正しく書き込めません。
### コマンド一覧
- `/totu`
その日の残凸数を返します。
- `/day (day)`
引数で指定した数字の日にExcelの記録位置をセットします。
このコマンドを実行すると記録位置が一律書き換えられるので、元の日に戻して記録をしようとしても、その日の1凸目からになってしまいます。
- `/clear (day)`
引数で指定した数字の日、または'day1'～'day6'と'all'のExcelの記録を消去します。
消去が成功すればExcelの記録位置と残凸数もリセットされます。
- `/pull`
このコマンドを実行したチャンネル上にExcelファイルをアップロードします。
- `/append`
このコマンドを実行したチャンネルを作業チャンネルとします。
- `/remove`
作業チャンネルでこのコマンドを実行すると作業チャンネルから除外されます。
- `/member (op, *member)`
引数opに対応した操作をExcelのメンバー一覧に適用します。引数memberはスペース区切りで複数指定できます。
#### op一覧
| op     | 動作                        |
|:-------|:---------------------------:|
| add    | メンバーを追加します。        |
| remove | メンバーを削除します。        |
| clear  | すべてのメンバーを削除します。 |
| delete | 末尾のメンバーを削除します。   |
#### Excel表記ルール
|凸|LA1|LA2|LA3|LA4|LA5|
|:-:|:-:|:-:|:-:|:-:|:-:|
|〇|△|◆|□|◎|☆|
LA(LastAttack)は持ち越しが発生するためカウントされても残凸が減らず、持ち越しを消費したタイミングで減ります。そのため1凸消費でLAを2つ取った場合、残凸数がズレます。
***

This software includes the work that is distributed in the Apache License 2.0.
http://www.apache.org/licenses/LICENSE-2.0
